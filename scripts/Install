#!/data/data/com.termux/files/usr/bin/bash

APP_ROOT="$HOME/termpak-apps"
mkdir -p "$APP_ROOT"

CMD="$1"
APP="$2"

BASE_URL="https://raw.githubusercontent.com/jmzao/TermHub/main"

case "$CMD" in

    install)
        if [ "$APP" != "termhub" ]; then
            echo "Uso correto: termhub install termhub"
            exit 1
        fi

        echo "Instalando TermHub..."

        HUB_DIR="$APP_ROOT/TermHub"
        mkdir -p "$HUB_DIR"

        # URLs do repositório
        JAR_URL="$BASE_URL/TermHubApp/TermHub.jar"
        IMG_URL="$BASE_URL/images/TermHub.png"

        echo "Baixando TermHub.jar..."
        wget -q "$JAR_URL" -O "$HUB_DIR/TermHub.jar" || {
            echo "Erro ao baixar TermHub.jar"
            exit 1
        }

        echo "Baixando imagem TermHub.png..."
        wget -q "$IMG_URL" -O "$HUB_DIR/TermHub.png" || {
            echo "Erro ao baixar imagem PNG"
            exit 1
        }

        echo "Criando comando interno 'termhub-run'..."
        echo "#!/data/data/com.termux/files/usr/bin/bash
java -jar \"$HUB_DIR/TermHub.jar\"" > "$PREFIX/bin/termhub-run"
        chmod +x "$PREFIX/bin/termhub-run"

        echo "TermHub instalado com sucesso!"

        # Perguntar sobre criar atalho
        echo -n "Quer criar um atalho na área de trabalho? (s/n): "
        read RESP

        if [ "$RESP" = "s" ] || [ "$RESP" = "S" ]; then
            DESKTOP="$HOME/Desktop"
            mkdir -p "$DESKTOP"

            SHORTCUT="$DESKTOP/TermHub.desktop"

            echo "Criando atalho..."

            cat > "$SHORTCUT" <<EOF
[Desktop Entry]
Type=Application
Name=TermHub
Exec=termhub-run
Icon=$HUB_DIR/TermHub.png
Terminal=false
EOF

            chmod +x "$SHORTCUT"

            echo "Atalho criado em: $SHORTCUT"
        fi

        ;;

    *)
        echo "Comando desconhecido."
        echo "Uso:"
        echo "  termhub install termhub"
        ;;
esac
