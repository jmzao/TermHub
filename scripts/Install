#!/data/data/com.termux/files/usr/bin/bash

# Diretório para apps instalados
APPS_DIR="$HOME/termpak-apps"
mkdir -p "$APPS_DIR"

# Caminhos do TermHub no repositório
TERMHUB_APP_DIR="$HOME/TermHubApp"
TERMHUB_JAR="$TERMHUB_APP_DIR/TermHub.jar"
TERMHUB_IMG="$HOME/TermHub/images/TermHub.png"

# Função para instalar o TermHub
install_termhub() {
    if [ ! -f "$TERMHUB_JAR" ]; then
        echo "Erro: TermHub.jar não encontrado em $TERMHUB_APP_DIR!"
        exit 1
    fi

    mkdir -p "$APPS_DIR/TermHub"
    cp "$TERMHUB_JAR" "$APPS_DIR/TermHub/TermHub.jar"
    echo "TermHub instalado com sucesso!"

    # Perguntar sobre atalho
    read -p "Deseja criar um atalho no Termux (comando 'termbhub')? [s/N]: " RESP
    if [[ "$RESP" =~ ^[Ss]$ ]]; then
        echo "#!/data/data/com.termux/files/usr/bin/bash
java -jar $APPS_DIR/TermHub/TermHub.jar" > "$PREFIX/bin/termbhub"
        chmod +x "$PREFIX/bin/termbhub"
        echo "Atalho criado! Use 'termbhub' para abrir a loja."
    fi

    # Perguntar sobre ícone
    if [ -f "$TERMHUB_IMG" ]; then
        read -p "Deseja copiar o ícone na área de trabalho do Termux? [s/N]: " ICON
        if [[ "$ICON" =~ ^[Ss]$ ]]; then
            mkdir -p "$APPS_DIR/TermHub/images"
            cp "$TERMHUB_IMG" "$APPS_DIR/TermHub/images/TermHub.png"
            echo "Ícone copiado! Use '$APPS_DIR/TermHub/images/TermHub.png'."
        fi
    fi
}

# Interpretar subcomandos
case "$1" in
    install)
        if [ "$2" = "termhub" ]; then
            install_termhub
        else
            echo "App desconhecido ou nome errado!"
        fi
        ;;
    *)
        echo "Comando inválido! Use: termhub install termhub"
        ;;
esac
