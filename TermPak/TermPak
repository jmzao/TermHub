#!/bin/bash

TERMPAK_DIR="$HOME/termpak-apps"
IMG_DIR="$HOME/images"
USR_DIR="$HOME/usr"
ETC_DIR="$HOME/etc"

mkdir -p "$TERMPAK_DIR" "$IMG_DIR" "$USR_DIR" "$ETC_DIR" "$USR_DIR/bin"

install_app() {
    APP="$1"
    DEB_PATH="$TERMPAK_DIR/${APP}.deb"
    PNG_PATH="$IMG_DIR/${APP}.png"

    if [ ! -f "$DEB_PATH" ]; then
        echo "Pacote ${APP}.deb não encontrado em $TERMPAK_DIR"
        exit 1
    fi

    echo "Instalando $APP a partir de $DEB_PATH..."

    TMP_DIR="$(mktemp -d)"
    dpkg-deb -x "$DEB_PATH" "$TMP_DIR"

    echo "Copiando arquivos para $USR_DIR e $ETC_DIR..."
    [ -d "$TMP_DIR/usr" ] && cp -r "$TMP_DIR/usr/"* "$USR_DIR/" 2>/dev/null
    [ -d "$TMP_DIR/etc" ] && cp -r "$TMP_DIR/etc/"* "$ETC_DIR/" 2>/dev/null

    rm -rf "$TMP_DIR"

    if [ -f "$PNG_PATH" ]; then
        echo "Ícone encontrado: $PNG_PATH"
    else
        echo "Sem ícone PNG correspondente em images/"
    fi

    echo "Instalação concluída."
}

uninstall_app() {
    APP="$1"
    echo "Desinstalar ainda não implementado."
}

if [ "$1" = "install" ]; then
    install_app "$2"
elif [ "$1" = "uninstall" ]; then
    uninstall_app "$2"
else
    echo "Uso: TermPak install <app>"
fi
