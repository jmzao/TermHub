#!/data/data/com.termux/files/usr/bin/bash
# TermPak CLI - Gerenciar apps TermHub

REPO_URL="https://raw.githubusercontent.com/jmzao/termhub/main/apps"
APPS_DIR="$HOME/termpak-apps"

mkdir -p "$APPS_DIR"

case "$1" in
    list)
        echo "Apps disponíveis no TermHub:"
        curl -s "$REPO_URL/index.txt" || echo "Não foi possível acessar o repositório."
        ;;
    search)
        if [ -z "$2" ]; then
            echo "Uso: TermPak search <nome_do_app>"
            exit 1
        fi
        RESULT=$(curl -s "$REPO_URL/index.txt" | grep -i "$2")
        if [ -z "$RESULT" ]; then
            echo "Aplicativo não existe ou nome errado!"
        else
            echo "$RESULT"
        fi
        ;;
    install)
        if [ -z "$2" ]; then
            echo "Uso: TermPak install <nome_do_app>"
            exit 1
        fi
        APP="$2"
        if ! curl -s "$REPO_URL/index.txt" | grep -q -i "^$APP\$"; then
            echo "Aplicativo não existe ou nome errado!"
            exit 1
        fi
        echo "Baixando e instalando $APP..."
        wget -q "$REPO_URL/$APP.deb" -O "$APPS_DIR/$APP.deb"
        dpkg -i "$APPS_DIR/$APP.deb" || echo "Erro ao instalar $APP"
        ;;
    remove)
        if [ -z "$2" ]; then
            echo "Uso: TermPak remove <nome_do_app>"
            exit 1
        fi
        APP="$2"
        if [ ! -f "$APPS_DIR/$APP.deb" ]; then
            echo "Aplicativo não existe ou não está instalado!"
            exit 1
        fi
        echo "Removendo $APP..."
        dpkg -r "$APP" || echo "Erro ao remover $APP"
        rm -f "$APPS_DIR/$APP.deb"
        ;;
    *)
        echo "Comando inválido! Use: list, search, install, remove"
        ;;
esac
