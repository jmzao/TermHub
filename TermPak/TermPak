#!/data/data/com.termux/files/usr/bin/bash

REPO_URL="https://raw.githubusercontent.com/jmzao/termhub/main/apps"

case "$1" in
    list)
        echo "[✓] Lista de apps disponíveis:"
        curl -s "$REPO_URL/Packages" | grep "Package:" | cut -d' ' -f2
        ;;

    search)
        if [ -z "$2" ]; then
            echo "Use: TermPak search nome"
            exit 1
        fi
        echo "[✓] Resultados da busca:"
        curl -s "$REPO_URL/Packages" | grep -iA2 "Package: $2"
        ;;

    install)
        if [ -z "$2" ]; then
            echo "Use: TermPak install nome"
            exit 1
        fi

        PKG="$2"
        DEB_URL="$REPO_URL/${PKG}.deb"

        echo "[✓] Baixando $PKG..."
        wget "$DEB_URL" -O "/sdcard/Download/${PKG}.deb"

        if [ $? -ne 0 ]; then
            echo "Erro: app '$PKG' não encontrado no repositório."
            exit 1
        fi

        echo "[✓] Instalando..."
        dpkg -i "/sdcard/Download/${PKG}.deb" || apt -f install -y

        echo "[✓] Instalação concluída!"
        ;;

    *)
        echo "TermPak - Sistema de apps"
        echo ""
        echo "Comandos:"
        echo "  TermPak list              Lista todos apps"
        echo "  TermPak search <nome>     Busca apps"
        echo "  TermPak install <app>     Instala um app"
        echo ""
        ;;
esac
