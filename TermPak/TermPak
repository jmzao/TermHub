#!/bin/bash

REPO_PATH="$HOME/termhub/apps"

cmd="$1"
arg="$2"

if [ -z "$cmd" ]; then
    echo "Uso:"
    echo "  TermPak list"
    echo "  TermPak search <nome>"
    echo "  TermPak install <app>"
    exit 1
fi

# Comando: listar todos apps
if [ "$cmd" = "list" ]; then
    echo "Apps disponíveis no TermHub:"
    for app in "$REPO_PATH"/*; do
        [ -d "$app" ] || continue
        appname=$(basename "$app")
        echo " - $appname"
    done
    exit 0
fi

# Comando: buscar app pelo nome
if [ "$cmd" = "search" ]; then
    if [ -z "$arg" ]; then
        echo "Uso: TermPak search <nome>"
        exit 1
    fi

    echo "Resultados para \"$arg\":"
    for app in "$REPO_PATH"/*; do
        [ -d "$app" ] || continue
        appname=$(basename "$app")
        if echo "$appname" | grep -qi "$arg"; then
            echo " - $appname"
        fi
    done
    exit 0
fi

# Comando: instalar app
if [ "$cmd" = "install" ]; then
    if [ -z "$arg" ]; then
        echo "Uso: TermPak install <app>"
        exit 1
    fi

    APP_DIR="$REPO_PATH/$arg"

    if [ ! -d "$APP_DIR" ]; then
        echo "App \"$arg\" não encontrado no TermHub!"
        exit 1
    fi

    INSTALLER="$APP_DIR/install.sh"

    if [ ! -f "$INSTALLER" ]; then
        echo "Instalador não encontrado em $INSTALLER"
        exit 1
    fi

    echo "Instalando $arg..."
    chmod +x "$INSTALLER"
    bash "$INSTALLER"
    exit 0
fi

echo "Comando desconhecido: $cmd"
echo "Use: TermPak list | search | install"
